<?php
/**
 * Brief Class Description.
 * Complete Class Description.
 */
class MConfigLoader
{
    /**
     * Attribute Description.
     */
    private $conf;
    private $defaultConf;

    /**
     * Brief Description.
     * Complete Description.
     *
     * @returns (tipo) desc
     *
     */
    function __construct()
    {
        $this->setDefaultConf();
    }

    /**
     * Brief Description.
     * Complete Description.
     *
     * @param $module' (tipo) desc
     *
     * @returns (tipo) desc
     *
     */
    function loadConf($module = '')
    {
        //$file = ($module == '') ? '../etc/miolo.conf' : '../modules/' . $module . '/etc/module.conf';
        $dir = substr($_SERVER['DOCUMENT_ROOT'], 0, strrpos($_SERVER['DOCUMENT_ROOT'], '/html') );
        if ( $module == '' ) 
        {
            //$file =  $dir . '/etc/miolo.conf';
        }
        else
        {
            $file =  $dir . '/modules/' . $module . '/etc/module.conf';
        }

        $xml = new MSimpleXML($file);
        $this->conf = $xml->ToSimpleArray($this->conf);
    }

    /**
     * Brief Description.
     * Complete Description.
     *
     * @param $key (tipo) desc
     *
     * @returns (tipo) desc
     *
     */
    function getConf($key)
    {
        $value = is_null($this->conf[$key])
                        ? $this->defaultConf[$key]
                        : $this->conf[$key];
        return $value;
    }

    /**
     * Brief Description.
     * Complete Description.
     *
     * @param $key (tipo) desc
     * @param $value (tipo) desc
     *
     * @returns (tipo) desc
     *
     */
    function setConf($key, $value)
    {
        $this->conf[$key] = $value;
    }
    /**
     * Brief Description.
     * Complete Description.
     *
     * @param $key (tipo) desc
     * @param $value (tipo) desc
     *
     * @returns (tipo) desc
     *
     */
    function setDefaultConf()
    {
        $homeMiolo = $this->getConf("home.miolo");
        $this->defaultConf = array(
            "home.classes"=>$homeMiolo."/classes",
            "home.modules"=>$homeMiolo."/modules",
            "home.etc"=>$homeMiolo."/etc",
            "home.logs"=>$homeMiolo."/var/log",
            "home.trace"=>$homeMiolo."/var/trace",
            "home.db"=>$homeMiolo."/var/db",
            "home.html"=>$homeMiolo."/html",
            "home.themes"=>$homeMiolo."/classes/ui/themes",
            "home.extensions"=>$homeMiolo."/extensions",
            "home.reports"=>$homeMiolo."/var/reports",
            "home.images"=>$homeMiolo."/ui/images",
                
            "home.url_themes"=>"/themes",
            "home.url_reports"=>"/reports",
            "home.module.themes"=>"/ui/themes",
            "home.module.html"=>"/html",
            "home.module.images"=>"/html/images",

            "namespace.core"=>"/classes",
            "namespace.service"=>"/classes/services",
            "namespace.ui"=>"/classes/ui",
            "namespace.themes"=>"/ui/themes",
            "namespace.extensions"=>"/classes/extensions",
            "namespace.controls"=>"/ui/controls",
            "namespace.database"=>"/classes/database",
            "namespace.utils"=>"/classes/utils",
            "namespace.modules"=>"/modules"
        );
    }
}
?>
